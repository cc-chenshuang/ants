<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ants.modules.ArticleManage.mapper.ArticleManageMapper">

    <select id="initArticleSort" resultType="com.ants.modules.ArticleManage.vo.ArticleManageVo">
        SELECT
        COUNT( a.article_sort ) number,
        b.`name` value,
	    b.id
        FROM
        (
        SELECT
        SUBSTRING_INDEX( SUBSTRING_INDEX( a.article_sort, ',', b.help_topic_id + 1 ), ',', - 1 ) AS article_sort
        FROM
        `article_manage` AS a
        JOIN mysql.help_topic AS b ON b.help_topic_id <![CDATA[ < ]]> ( length( a.article_sort ) - length( REPLACE ( a.article_sort, ',', '' ) ) + 1 )
        WHERE
        a.del_flag = '0'
        ) a
        INNER JOIN ( SELECT id, `name` FROM article_sort ) b ON a.article_sort = b.id
        GROUP BY
        a.article_sort
    </select>
    <select id="initArticleLable" resultType="com.ants.modules.ArticleManage.vo.ArticleManageVo">
        SELECT
            a.id id,
            a.NAME `value`,
            SUM( 1 ) number
        FROM
            article_lable a
            LEFT JOIN article_manage b ON FIND_IN_SET( a.id, b.article_lable )
        WHERE
            a.create_by = #{username}
        GROUP BY
            a.id
    </select>
    <select id="articleGroupByCreateTime" resultType="java.util.Map">
        SELECT LEFT
            ( create_time, 7 ) createMonth,
            count( 1 ) sum
        FROM
            `article_manage`
        where del_flag = '0'
        GROUP BY
            LEFT ( create_time, 7 )
        ORDER BY
            LEFT ( create_time, 7 ) DESC
    </select>
    <select id="getArticleByTime" parameterType="string" resultType="com.ants.modules.ArticleManage.entity.ArticleManage">
        SELECT
            *
        FROM
            `article_manage`
        WHERE del_flag = '0'
        and LEFT ( create_time, 7 ) = #{time}
        order by create_time desc
    </select>
    <select id="searchAllActive" parameterType="string" resultType="com.ants.modules.ArticleManage.entity.ArticleManage">
        SELECT
            *
        FROM
            article_manage
        WHERE del_flag = '0'
        and MATCH ( title, content ) against ( #{value} );
    </select>
</mapper>
